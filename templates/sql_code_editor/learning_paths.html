{% extends "base.html" %}

{% block content %}
<div class="learning-paths-container">
    <h1>Learning Paths</h1>
    <p>Structured paths to guide your SQL learning journey</p>
    
    <!-- Path Filters -->
    <div class="path-filters">
        <div class="filter-group">
            <label>Difficulty:</label>
            <select id="difficulty-filter">
                <option value="">All Levels</option>
                <option value="BEGINNER">Beginner</option>
                <option value="INTERMEDIATE">Intermediate</option>
                <option value="ADVANCED">Advanced</option>
                <option value="EXPERT">Expert</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label>Industry:</label>
            <select id="industry-filter">
                <option value="">All Industries</option>
                {% for industry in industries %}
                <option value="{{ industry.id }}">{{ industry.name }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="filter-group">
            <label>Duration:</label>
            <select id="duration-filter">
                <option value="">Any Duration</option>
                <option value="short">Short (< 5 hours)</option>
                <option value="medium">Medium (5-10 hours)</option>
                <option value="long">Long (> 10 hours)</option>
            </select>
        </div>
    </div>
    
    <!-- Path Grid -->
    <div class="paths-grid">
        {% for path in learning_paths %}
        <div class="path-card" 
             data-difficulty="{{ path.difficulty }}"
             data-industry="{% for industry in path.industries %}{{ industry.id }} {% endfor %}"
             data-duration="{% if path.estimated_hours < 5 %}short{% elif path.estimated_hours < 10 %}medium{% else %}long{% endif %}">
            <div class="path-header">
                <h2>{{ path.name }}</h2>
                <span class="difficulty-badge {{ path.difficulty|lower }}">{{ path.difficulty }}</span>
            </div>
            
            <div class="path-meta">
                <span class="meta-item">
                    <i class="fa fa-clock"></i> {{ path.estimated_hours }} hours
                </span>
                <span class="meta-item">
                    <i class="fa fa-database"></i> {{ path.dataset_count }} datasets
                </span>
                <span class="meta-item">
                    <i class="fa fa-tasks"></i> {{ path.question_count }} questions
                </span>
            </div>
            
            <p class="path-description">{{ path.description }}</p>
            
            <div class="path-industries">
                {% for industry in path.industries %}
                <span class="industry-tag">{{ industry.name }}</span>
                {% endfor %}
            </div>
            
            <div class="path-progress">
                {% if path.user_progress %}
                <div class="progress">
                    <div class="progress-bar" style="width: {{ path.user_progress.percentage }}%">
                        {{ path.user_progress.percentage }}%
                    </div>
                </div>
                <div class="progress-text">
                    {{ path.user_progress.completed_datasets }}/{{ path.dataset_count }} datasets completed
                </div>
                {% else %}
                <div class="progress">
                    <div class="progress-bar" style="width: 0%">0%</div>
                </div>
                <div class="progress-text">Not started</div>
                {% endif %}
            </div>
            
            <div class="path-actions">
                {% if path.user_progress %}
                <a href="{% url 'learningpath_detail' pk=path.id %}" class="btn btn-continue">
                    Continue Path
                </a>
                {% else %}
                <a href="{% url 'start_learning_path' path_id=path.id %}" class="btn btn-start">
                    Start Path
                </a>
                {% endif %}
                <a href="{% url 'learningpath_detail' pk=path.id %}" class="btn btn-outline">
                    View Details
                </a>
            </div>
        </div>
        {% empty %}
        <div class="no-paths">
            <p>No learning paths available yet. Check back soon!</p>
        </div>
        {% endfor %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Get filter elements
    const difficultyFilter = document.getElementById('difficulty-filter');
    const industryFilter = document.getElementById('industry-filter');
    const durationFilter = document.getElementById('duration-filter');
    const pathCards = document.querySelectorAll('.path-card');
    
    // Add event listeners to filters
    difficultyFilter.addEventListener('change', filterPaths);
    industryFilter.addEventListener('change', filterPaths);
    durationFilter.addEventListener('change', filterPaths);
    
    // Filter function
    function filterPaths() {
        const difficultyValue = difficultyFilter.value;
        const industryValue = industryFilter.value;
        const durationValue = durationFilter.value;
        
        pathCards.forEach(card => {
            const cardDifficulty = card.dataset.difficulty;
            const cardIndustries = card.dataset.industry.split(' ');
            const cardDuration = card.dataset.duration;
            
            // Check filters
            const matchesDifficulty = !difficultyValue || cardDifficulty === difficultyValue;
            const matchesIndustry = !industryValue || cardIndustries.includes(industryValue);
            const matchesDuration = !durationValue || cardDuration === durationValue;
            
            if (matchesDifficulty && matchesIndustry && matchesDuration) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        });
    }
});
</script>
{% endblock %}